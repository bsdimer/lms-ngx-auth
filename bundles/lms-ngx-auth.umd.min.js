!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("@angular/common/http"),require("rxjs/operators"),require("@auth0/angular-jwt")):"function"==typeof define&&define.amd?define("lms-ngx-auth",["exports","@angular/core","rxjs","@angular/common/http","rxjs/operators","@auth0/angular-jwt"],t):t((e=e||self)["lms-ngx-auth"]={},e.ng.core,e.rxjs,e.ng.common.http,e.rxjs.operators,e.angularJwt)}(this,(function(e,t,r,n,o,i){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function a(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var s=new t.InjectionToken("AuthenticationConfig");var u=function(e){this.authorities=[],this.email=e.email,this.emailVerified=e.email_verified,this.expiresAt=e.exp,this.givenName=e.given_name,this.familyName=e.family_name,this.phone=e.phone_number,this.picture=e.picture,this.scope=e.scope,this.id=e.sub,this.authorities=e.roles};var c=function(){function e(e,t){this.config=e,this.httpClient=t,this.tokenName="@lms/authToken",this.jwtHelperService=new i.JwtHelperService;var n=new u({});if(localStorage.getItem(this.tokenName)){var o=localStorage.getItem(this.tokenName),a=this.jwtHelperService.decodeToken(JSON.parse(o).accessToken);n=new u(a)}this.currentUserSubject=new r.BehaviorSubject(n),this.currentUser=this.currentUserSubject.asObservable(),this.currentUserSubject.next(n)}return Object.defineProperty(e.prototype,"authenticationChange$",{get:function(){return this.currentUserSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"authenticationChangeSimple$",{get:function(){var e=this;return this.currentUserSubject.asObservable().pipe(o.map((function(){return e.isAuthenticated()})))},enumerable:!0,configurable:!0}),e.prototype.getAuthorizationHeader=function(){var e=localStorage.getItem(this.tokenName);return e?"Bearer "+JSON.parse(e).accessToken:""},e.prototype.isAuthenticated=function(){var e=JSON.parse(localStorage.getItem(this.tokenName));return null!=e&&!this.jwtHelperService.isTokenExpired(e.accessToken)},e.prototype.getSession=function(){return this.currentUserSubject.value},e.prototype.login=function(e,t){var r=this;localStorage.removeItem(this.tokenName);var i=new n.HttpHeaders({Authorization:"Basic "+btoa(this.config.client.name+":"+this.config.client.password),Accept:"application/json","Content-Type":"application/json"}),a={username:e,password:t,grant_type:"password"};return this.httpClient.post(this.config.loginUrl,a,{headers:i}).pipe(o.map((function(e){var t=r.jwtHelperService.decodeToken(e.accessToken),n=new u(t);return e&&(localStorage.setItem(r.tokenName,JSON.stringify(e)),r.currentUserSubject.next(n)),n})),o.share())},e.prototype.signUp=function(e){return this.httpClient.post(this.config.signUpUrl,e)},e.prototype.logout=function(){return localStorage.removeItem(this.tokenName),this.currentUserSubject.next(null),r.of(!0)},e.prototype.prepareHttpClientAuthHeader=function(){return{headers:{Authorization:this.getAuthorizationHeader()}}},e.prototype.whoami=function(){return this.httpClient.get("/user/me",this.prepareHttpClientAuthHeader())},e.prototype.hasRole=function(e){var t,r;try{for(var n=a(this.getSession().authorities),o=n.next();!o.done;o=n.next()){var i=o.value;if(i.role===e&&i.client===this.config.client.name)return!0}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return!1},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[s]}]},{type:n.HttpClient}]},e.ngInjectableDef=t.ɵɵdefineInjectable({factory:function(){return new e(t.ɵɵinject(s),t.ɵɵinject(n.HttpClient))},token:e,providedIn:"root"}),e}();var p=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[c,{provide:s,useValue:t}]}},e.decorators=[{type:t.NgModule}],e}(),l=function(){};var h=function(){this.properties={}};var f=function(){};var g=function(){};e.AUTH_CONFIG=s,e.LmsNgxAuthModule=p,e.LmsNgxAuthService=c,e.RoleEntity=g,e.Session=u,e.SignUpRequest=h,e.UserEntity=f,e.UserEntityProperty=l,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=lms-ngx-auth.umd.min.js.map